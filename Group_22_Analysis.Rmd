---
title: "Group_22_Analysis"
author: "Group22"
date: "2023-03-08"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
#reading data
data <- read.csv("dataset22.csv")


#loading libraries
library(tidyverse)
library(moderndive)
library(sjPlot)
library(stats)
library(jtools)
library(GGally)
library(janitor)
library(gridExtra)
library(kableExtra)
```

## Introduction

We have been tasked with finding out which properties of the furniture influence whether the products price is more than 1000 Saudi Riyals. Here we shall analyse the data provided to us by the company, working with continuous variables for price, width, depth and height as well as categorical variables for category, whether the product is sold online and whether the product is available in multiple colours. 

Section 2 consists of an exploratory data analysis of the data. Section 3 contains the contains the formal analysis of fitting the GLMs, the model selection and data visualizations resulting from the model selected. Section 4 contains our conclusions.

```{r, echo=FALSE, warning=FALSE, message=FALSE}
#data tidying
#creating variable volume
data <- data %>%
  mutate(volume= height*depth*width)

#splitting price into categories expensive yes or no
data$Expensive <- NA
data$Expensive[data$price<1000] <- 0
data$Expensive[data$price>=1000] <- 1
data$Expensive <- factor(data$Expensive, labels=c("No", "Yes"))



#tidying category with irregular symbol
#unique(data$category)
#data[148,3]
data[148,3] = "Cafe furniture"
```

## Exploratory Data Analysis

As we are interested in whether a product is sold at more or less than 1000 Riyals, we dichotamised the variable for price into a categorical variable, Expenisve. Products sold for more than 1000 Riyals are denoted "Yes" and products sold for less than 1000 Riyals are denoted "No". Below we provide a table showing the proportion of products considered expensive.

```{r, echo=FALSE, warning=FALSE, message=FALSE}
#table for overall expensive
tabyl(data$Expensive) %>%
  kable(caption= "counts and percentages of products sorted by whether they are expensive or not") %>%
  kable_styling(font_size = 10, latex_options = "hold_position")

```

We now turn our attention to which variables influence whether a product is considered expensive or not. From the scatterplots below we can see that in terms of the continuous variables width appears to be the most important. Item ID does not appear to be influential while both height and depth are marginal.


```{r, echo=FALSE, warning=FALSE, message=FALSE}
#plots
#boxplot of category and height
p1 <-ggplot(data = data, aes(x = category, y = price, na.rm=TRUE)) +
  geom_boxplot(fill= "skyblue") +
  labs(x = "Category", y = "price")+ 
  theme(legend.position = "none")

#scatterplot of width and expensive
p2 <- ggplot(data= data, aes(x=width, y = Expensive, na.rm=TRUE)) +
  geom_jitter(width=20) +
  labs(x="width", y="expensive", title= "Width of product")

#scatterplot of depth and expensive
p3 <- ggplot(data= data, aes(x=depth, y = Expensive, na.rm=TRUE)) +
  geom_jitter(width=20) +
  labs(x="depth", y="expensive", title="Depth of product")

#scatterplot of height and expensive
p4 <-ggplot(data= data, aes(x=height, y = Expensive, na.rm=TRUE)) +
  geom_jitter(width=20) +
  labs(x="height", y="expensive", title="Height of product")

#scatterplot of volume and expensive
p5 <-ggplot(data= data, aes(x=volume, y = Expensive, na.rm=TRUE)) +
  geom_jitter(width=20) +
  labs(x="volume", y= "expensive", title= "Volume of product")
       
#scatterplot of item_id and expensive
p6 <-ggplot(data= data, aes(x=item_id, y = Expensive, na.rm=TRUE)) +
  geom_jitter(width=20) +
  labs(x="item_id", y="expensive", title= "item id of product")

grid.arrange(p2, p3, p4, p6, ncol=2)
```

Checking the the continuous variables for any high collinearity, we see from the scatterplot matrix that there is moderate positive correlation between depth and width and also between depth and height. As the strengh is only moderate and the other variables are very weakly correlated, there is not much concern regarding collinearity.

```{r, echo=FALSE, warning=FALSE, message=FALSE}
#poducing gg pairs to check for high collinearity
continuousdata <- data %>%
  select(item_id, width, depth, height)

ggpairs(continuousdata, title="correlation of continous variables") 

```

Looking at the categorical variables we can see that as so few products are not sold online, it it unlikely to be influential. Also the proportions for expensive are very similar for multiple colours so it is also unlikely to have much influence.

```{r, echo=FALSE, warning=FALSE, message=FALSE}

#categorical variables

#expensive and multiple colours
#table 
t1 <- data %>% 
  tabyl(Expensive, other_colors) %>% 
  adorn_percentages() %>% 
  adorn_pct_formatting() %>% 
  adorn_ns() %>%
  kable(caption="percentages and counts of products separated whether they have multiple colours ") %>%
  kable_styling(font_size = 10, latex_options = "hold_position")
t1
#barplot
bp1 <- ggplot(data, aes(x = other_colors, fill = Expensive, na.rm=TRUE)) +
  geom_bar(stat = "count", position = "dodge") +
  xlab("other colours") + ylab("Frequency") +
  theme(legend.position="bottom")

#expensive and sold online
#table
t2 <- data %>% 
  tabyl(Expensive, sellable_online) %>% 
  adorn_percentages() %>% 
  adorn_pct_formatting() %>% 
  adorn_ns() %>%
  kable(caption= "percentages and counts of products separated by whether they are sold online") %>%
  kable_styling(font_size = 10, latex_options = "hold_position")

t2
#barplot
bp2 <-ggplot(data, aes(x = sellable_online, fill = Expensive, na.rm=TRUE)) +
  geom_bar(stat = "count", position = "dodge")+
  xlab("Sellable Online") + ylab("Frequency") +
  theme(legend.position= "bottom")

grid.arrange(bp1,bp2,ncol=2)

```

From the plot below we see that categories is likely to be an influential factor. Wardrobes, Sofas and Armchairs and beds in particular have a high proportion of expensive products. Meanwhile Childrens furniture contains no expensive products at all. Some categories contain so few products that they are unlikely to be influential.

```{r, echo=FALSE, warning=FALSE, message=FALSE}
#expensive and categories
#table
t3 <- data %>% 
  tabyl(category, Expensive) %>% 
  adorn_percentages() %>% 
  adorn_pct_formatting() %>% 
  adorn_ns() %>%
  kable(caption= "percentages and counts of products sorted by category") %>%
  kable_styling(font_size = 10, latex_options = "hold_position")
t3
#barplot
ggplot(data, aes(y=category,  fill = Expensive, na.rm=TRUE)) +
  geom_bar(stat = "count", position = "dodge", width=0.5) +
  ylab("Category") + xlab("Frequency") +
  theme(legend.position = "bottom") +
  ggtitle("Counts of expensive and not expensive categories")
```

## Formal analysis

## Conclusions
